(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11],{5488:(e,a,r)=>{Promise.resolve().then(r.bind(r,6460))},6460:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>s});var l=r(5155),t=r(2115),i=r(2651);function s(e){let{onClose:a,onEventCreated:r}=e,[s,n]=(0,t.useState)({title:"",description:"",startDate:"",endDate:"",location:"",isOnline:!1,isMemberOnly:!1,maxParticipants:"",registrationRequired:!0,registrationDeadline:"",memberPrice:"",nonMemberPrice:"",category:"",imgUrl:""}),[d,o]=(0,t.useState)(!1),[c,u]=(0,t.useState)(""),[m,b]=(0,t.useState)(null),[g,p]=(0,t.useState)(null),[x,h]=(0,t.useState)(0),y="dlr034bds",f=(0,t.useCallback)(e=>{let{name:a,value:r,type:l,checked:t}=e.target;"checkbox"===l?n(e=>({...e,[a]:t})):"number"===l?n(e=>({...e,[a]:""===r?"":parseFloat(r)})):n(e=>({...e,[a]:r}))},[]),v=(0,t.useCallback)(e=>{let a=e.target.files[0];if(a){if(a.size>5242880){u("❌ L'image ne doit pas d\xe9passer 5MB");return}if(!["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(a.type)){u("❌ Veuillez s\xe9lectionner un fichier image valide (JPG, PNG, GIF, WebP)");return}let e=new FileReader;e.onload=e=>{p(e.target.result)},e.readAsDataURL(a),b(a),u("")}},[]),j=(0,t.useCallback)(()=>{b(null),p(null)},[]),N=async e=>{try{let a=new FormData;a.append("file",e),a.append("upload_preset","FAPKREIFEUR"),a.append("cloud_name",y),a.append("tags","event_image"),h(30),u("\uD83D\uDCE4 Upload vers Cloudinary en cours...");let r=await i.A.post("https://api.cloudinary.com/v1_1/".concat(y,"/image/upload"),a,{onUploadProgress:e=>{if(e.total){let a=Math.round(100*e.loaded/e.total);h(a)}}});return h(100),{secure_url:r.data.secure_url,public_id:r.data.public_id,format:r.data.format,width:r.data.width,height:r.data.height,bytes:r.data.bytes,created_at:r.data.created_at,original_filename:r.data.original_filename,optimized_url:r.data.secure_url.replace("/upload/","/upload/c_fill,w_800,h_450,q_auto,f_auto/"),thumbnail_url:r.data.secure_url.replace("/upload/","/upload/c_fill,w_300,h_200,q_auto,f_auto/")}}catch(e){var a,r,l;throw console.error("Erreur Cloudinary upload:",e),Error((null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:null===(a=r.error)||void 0===a?void 0:a.message)||"\xc9chec de l'upload de l'image vers Cloudinary")}},w=async e=>{e.preventDefault(),o(!0),u(""),h(0);try{let e=localStorage.getItem("authToken");if(!e)throw Error("Token d'authentification manquant. Veuillez vous reconnecter.");if(!s.title||!s.description||!s.startDate||!s.endDate||!s.location||!s.category)throw Error("Veuillez remplir tous les champs obligatoires (*).");let l=new Date(s.startDate),t=new Date(s.endDate);if(l>=t)throw Error("La date de fin doit \xeatre post\xe9rieure \xe0 la date de d\xe9but.");let i=null;if(m)try{i=await N(m),u("✅ Image upload\xe9e avec succ\xe8s vers Cloudinary !")}catch(e){throw console.error("Erreur upload image Cloudinary:",e),Error("\xc9chec de l'upload de l'image: "+e.message)}let d={title:s.title,description:s.description,startDate:l.toISOString(),endDate:t.toISOString(),location:s.location,isOnline:s.isOnline,isMemberOnly:s.isMemberOnly,maxParticipants:s.maxParticipants?parseInt(s.maxParticipants):0,registrationRequired:s.registrationRequired,memberPrice:s.memberPrice?parseFloat(s.memberPrice):0,nonMemberPrice:s.nonMemberPrice?parseFloat(s.nonMemberPrice):0,category:s.category,...i&&{imgUrl:i.secure_url,image:{url:i.secure_url,publicId:i.public_id,optimizedUrl:i.optimized_url,thumbnailUrl:i.thumbnail_url,metadata:{format:i.format,width:i.width,height:i.height,size:i.bytes,originalFilename:i.original_filename,uploadedAt:i.created_at}}}};s.registrationDeadline&&(d.registrationDeadline=new Date(s.registrationDeadline).toISOString()),console.log("Donn\xe9es envoy\xe9es \xe0 l'API:",d);let o=await fetch("/api/events",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(d)}),c=await o.json();if(console.log("R\xe9ponse de l'API:",c),!o.ok)throw Error(c.message||"Erreur ".concat(o.status," lors de la cr\xe9ation de l'\xe9v\xe9nement"));if(c.success)u("✅ \xc9v\xe9nement cr\xe9\xe9 avec succ\xe8s !"),n({title:"",description:"",startDate:"",endDate:"",location:"",isOnline:!1,isMemberOnly:!1,maxParticipants:"",registrationRequired:!0,registrationDeadline:"",memberPrice:"",nonMemberPrice:"",category:""}),b(null),p(null),h(0),r&&r(),setTimeout(()=>{a(),u("")},2e3);else throw Error(c.message||"Erreur lors de la cr\xe9ation de l'\xe9v\xe9nement")}catch(e){console.error("Erreur d\xe9taill\xe9e:",e),u("❌ ".concat(e.message))}finally{o(!1),h(0)}};return(0,l.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,l.jsxs)("div",{className:"p-6",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,l.jsx)("h3",{className:"text-xl font-semibold text-blue-800",children:"Cr\xe9er un nouvel \xe9v\xe9nement"}),(0,l.jsx)("button",{onClick:a,className:"text-gray-400 hover:text-gray-600 text-2xl",disabled:d,children:"✕"})]}),c&&(0,l.jsxs)("div",{className:"p-4 rounded-md mb-6 ".concat(c.includes("✅")||c.includes("\uD83D\uDCE4")?"bg-blue-50 text-blue-700 border border-blue-200":c.includes("❌")?"bg-red-50 text-red-700 border border-red-200":"bg-green-50 text-green-700 border border-green-200"),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{children:c}),x>0&&(0,l.jsxs)("span",{className:"text-sm font-medium",children:[x,"%"]})]}),x>0&&(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:(0,l.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(x,"%")}})})]}),(0,l.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Image de l'\xe9v\xe9nement (Optionnel)"}),g?(0,l.jsxs)("div",{className:"relative mb-3",children:[(0,l.jsx)("img",{src:g,alt:"Aper\xe7u de l'\xe9v\xe9nement",className:"w-full h-48 object-cover rounded-md border border-gray-300"}),(0,l.jsx)("button",{type:"button",onClick:j,className:"absolute top-2 right-2 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",disabled:d,children:(0,l.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,l.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-md p-6 text-center hover:border-blue-400 transition-colors",children:[(0,l.jsx)("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),(0,l.jsx)("p",{className:"mt-1 text-sm text-gray-600",children:"Cliquez pour t\xe9l\xe9charger une image"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"JPG, PNG, GIF, WebP jusqu'\xe0 5MB"}),(0,l.jsx)("p",{className:"text-xs text-blue-500 mt-1",children:"(Upload direct vers Cloudinary)"})]}),(0,l.jsx)("input",{type:"file",accept:"image/jpeg,image/jpg,image/png,image/gif,image/webp",onChange:v,className:"hidden",id:"event-image-upload",disabled:d}),(0,l.jsx)("label",{htmlFor:"event-image-upload",className:"block w-full mt-2 px-4 py-2 rounded-md text-center transition-colors ".concat(d?"bg-gray-100 text-gray-500 cursor-not-allowed":"bg-blue-50 text-blue-700 hover:bg-blue-100 cursor-pointer"),children:d?"Chargement...":"T\xe9l\xe9charger une image"})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Titre de l'\xe9v\xe9nement *"}),(0,l.jsx)("input",{type:"text",name:"title",required:!0,value:s.title,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",placeholder:"Congr\xe8s International de Cosm\xe9tologie 2024",disabled:d})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cat\xe9gorie *"}),(0,l.jsx)("select",{name:"category",required:!0,value:s.category,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",disabled:d,children:[{value:"",label:"S\xe9lectionner une cat\xe9gorie"},{value:"Workshop",label:"Workshop"},{value:"Conference",label:"Conf\xe9rence"},{value:"Seminar",label:"S\xe9minaire"},{value:"Networking",label:"Networking"},{value:"Training",label:"Formation"},{value:"Social",label:"\xc9v\xe9nement Social"},{value:"Other",label:"Autre"}].map(e=>(0,l.jsx)("option",{value:e.value,children:e.label},e.value))})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description *"}),(0,l.jsx)("textarea",{name:"description",required:!0,value:s.description,onChange:f,rows:"3",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",placeholder:"Description d\xe9taill\xe9e de l'\xe9v\xe9nement...",disabled:d})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lieu *"}),(0,l.jsx)("input",{type:"text",name:"location",required:!0,value:s.location,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",placeholder:"Centre de Congr\xe8s de Paris",disabled:d})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de d\xe9but *"}),(0,l.jsx)("input",{type:"datetime-local",name:"startDate",required:!0,value:s.startDate,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",disabled:d})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date de fin *"}),(0,l.jsx)("input",{type:"datetime-local",name:"endDate",required:!0,value:s.endDate,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",disabled:d})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre maximum de participants"}),(0,l.jsx)("input",{type:"number",name:"maxParticipants",min:"0",value:s.maxParticipants,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",placeholder:"0 pour illimit\xe9",disabled:d})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date limite d'inscription"}),(0,l.jsx)("input",{type:"datetime-local",name:"registrationDeadline",value:s.registrationDeadline,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",disabled:d})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prix membre (DA)"}),(0,l.jsx)("input",{type:"number",name:"memberPrice",step:"0.01",min:"0",value:s.memberPrice,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",placeholder:"0.00",disabled:d})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prix non-membre (DA)"}),(0,l.jsx)("input",{type:"number",name:"nonMemberPrice",step:"0.01",min:"0",value:s.nonMemberPrice,onChange:f,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-50",placeholder:"0.00",disabled:d})]})]}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",name:"isOnline",checked:s.isOnline,onChange:f,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded disabled:opacity-50",disabled:d}),(0,l.jsx)("label",{className:"ml-2 text-sm text-gray-700",children:"\xc9v\xe9nement en ligne"})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",name:"isMemberOnly",checked:s.isMemberOnly,onChange:f,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded disabled:opacity-50",disabled:d}),(0,l.jsx)("label",{className:"ml-2 text-sm text-gray-700",children:"R\xe9serv\xe9 aux membres"})]}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("input",{type:"checkbox",name:"registrationRequired",checked:s.registrationRequired,onChange:f,className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded disabled:opacity-50",disabled:d}),(0,l.jsx)("label",{className:"ml-2 text-sm text-gray-700",children:"Inscription requise"})]})]}),(0,l.jsxs)("div",{className:"flex justify-end space-x-4 pt-6",children:[(0,l.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-100 transition-colors disabled:opacity-50",disabled:d,children:"Annuler"}),(0,l.jsxs)("button",{type:"submit",disabled:d,className:"px-4 py-2 bg-blue-800 text-white rounded-md hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2",children:[d&&(0,l.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,l.jsx)("span",{children:d?"Cr\xe9ation en cours...":"Cr\xe9er l'\xe9v\xe9nement"})]})]})]})]})})})}}},e=>{var a=a=>e(e.s=a);e.O(0,[651,441,517,358],()=>a(5488)),_N_E=e.O()}]);